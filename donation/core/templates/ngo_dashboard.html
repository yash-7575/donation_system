{% extends 'base.html' %}
{% block title %}NGO Dashboard ‚Äî GiveHope{% endblock %}
{% block content %}
<div id="ngo-scope" class="min-h-screen bg-gradient-to-br from-purple-50 via-cyan-50 to-orange-50 flex">
  <!-- Left Fixed Sidebar -->
  <aside class="w-64 bg-white shadow-lg fixed h-full flex flex-col">
    <div class="p-6 border-b">
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-12 h-12 bg-gradient-to-br from-purple-600 to-cyan-500 rounded-xl flex items-center justify-center">
          <span class="text-white text-2xl font-bold">‚ù§</span>
        </div>
        <span class="text-xl font-bold bg-gradient-to-r from-purple-600 to-cyan-600 bg-clip-text text-transparent">GiveHope</span>
      </div>
      <div class="flex items-center space-x-3 mt-6">
        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-orange-400 rounded-full flex items-center justify-center text-white font-bold">
          {{ ngo.ngo_name|first|upper }}
        </div>
        <div class="flex-1 min-w-0">
          <div class="font-semibold text-gray-900 truncate">{{ ngo.ngo_name }}</div>
          <div class="text-xs text-gray-500 truncate">{{ ngo.city }}, {{ ngo.state }}</div>
        </div>
      </div>
    </div>
    <nav class="p-4 space-y-2 flex-1 overflow-y-auto">
      <button data-tab-btn="dashboard" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üìä Dashboard</span></button>
      <button data-tab-btn="donations" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üéÅ Donations</span></button>
      <button data-tab-btn="requests" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üéØ Requests</span></button>
      <button data-tab-btn="analytics" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üìà Analytics</span></button>
      <button data-tab-btn="profile" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üë§ Profile</span></button>
      <button data-tab-btn="dbms" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üóÑÔ∏è DBMS Demo</span></button>
    </nav>
    <div class="p-4 border-t">
        <a href="{% url 'logout' %}" class="block text-center text-red-600 px-4 py-3 rounded-lg hover:bg-red-50 transition-all">üö™ Logout</a>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="flex-1 ml-64 p-8">
    <!-- TAB 1: Dashboard Overview -->
    <div data-tab-panel="dashboard" class="animate-fade-in">
      <div class="bg-gradient-to-r from-purple-600 to-cyan-500 text-white rounded-xl shadow-lg p-6 mb-8">
        <h1 class="text-3xl font-bold mb-2">Welcome back, {{ ngo.ngo_name }}!</h1>
        <p class="opacity-80">Here's your real-time impact overview. Keep up the great work!</p>
      </div>
      
      <!-- Stats Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-purple-100 text-purple-600 text-2xl">üéÅ</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.total_donations }}</div>
            <div class="text-gray-600">Total Donations</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-yellow-100 text-yellow-600 text-2xl">‚è≥</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.pending_requests }}</div>
            <div class="text-gray-600">Pending Requests</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-blue-100 text-blue-600 text-2xl">‚úÖ</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.accepted_donations }}</div>
            <div class="text-gray-600">Accepted Donations</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-green-100 text-green-600 text-2xl">üì¶</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.delivered_donations }}</div>
            <div class="text-gray-600">Delivered Donations</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-purple-100 text-purple-600 text-2xl">‚úîÔ∏è</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.fulfilled_requests }}</div>
            <div class="text-gray-600">Fulfilled Requests</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-orange-100 text-orange-600 text-2xl">‚≠ê</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.avg_rating }}/5</div>
            <div class="text-gray-600">Average Rating</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-blue-100 text-blue-600 text-2xl">üë•</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.active_donors }}</div>
            <div class="text-gray-600">Active Donors</div>
          </div>
        </div>
      </div>
      
      <!-- Chart: Donations by Category -->
      <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">Donations by Category</h3>
        {% if donations_by_category %}
        <div class="space-y-3">
          {% for item in donations_by_category %}
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3 flex-1">
              <div class="w-32 text-gray-700 font-medium">{{ item.category|title }}</div>
              <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">
                <div class="bg-gradient-to-r from-purple-500 to-cyan-500 h-full rounded-full" 
                     style="width: {% widthratio item.count stats.total_donations 100 %}%"></div>
              </div>
            </div>
            <div class="text-gray-900 font-bold ml-4">{{ item.count }}</div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
          <p class="text-gray-500">No donation data available yet</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- TAB 2: Donations Management -->
    <div data-tab-panel="donations" class="animate-fade-in hidden">
      <div class="bg-white rounded-xl shadow-md p-6 mb-8">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">üéÅ Donations Management</h1>
                <p class="text-gray-600">Track and manage all incoming donations.</p>
            </div>
            <div class="flex items-center space-x-2">
                <form method="GET" action="{% url 'ngo' %}" class="flex items-center space-x-2">
                    <select name="category" class="border border-gray-300 rounded-lg p-2" onchange="this.form.submit()">
                        <option value="">All Categories</option>
                        {% for category in available_categories %}
                        <option value="{{ category }}" {% if selected_category == category %}selected{% endif %}>
                            {{ category|title }}
                        </option>
                        {% endfor %}
                    </select>
                    <input type="text" name="search" value="{{ search_query }}" placeholder="Search donations..." 
                           class="border border-gray-300 rounded-lg p-2 w-64">
                    <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">Search</button>
                </form>
            </div>
        </div>
      </div>
      <div class="bg-white rounded-xl shadow-md p-2 overflow-x-auto">
        <table class="min-w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Title</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Category</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Qty</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Status</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Donor Name</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">City</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Date</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if donations %}
              {% for donation in donations %}
              <tr class="border-b hover:bg-gray-50">
                <td class="py-3 px-4">{{ donation.title }}</td>
                <td class="py-3 px-4">{{ donation.category|title }}</td>
                <td class="py-3 px-4">{{ donation.quantity }}</td>
                <td class="py-3 px-4">
                  {% if donation.status == 'delivered' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Delivered</span>
                  {% elif donation.status == 'accepted' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Accepted</span>
                  {% elif donation.status == 'cancelled' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Declined</span>
                  {% else %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Pending</span>
                  {% endif %}
                </td>
                <td class="py-3 px-4">{{ donation.donor.name }}</td>
                <td class="py-3 px-4">{{ donation.donor.city|default:"N/A" }}</td>
                <td class="py-3 px-4">{{ donation.created_at|date:"M d, Y" }}</td>
                <td class="py-3 px-4 space-x-2">
                  <button class="text-blue-600 hover:underline text-sm">View</button>
                  {% if donation.status == 'pending' %}
                    <form method="POST" action="{% url 'accept_donation' donation.id %}" class="inline">
                      {% csrf_token %}
                      <button type="submit" class="text-purple-600 hover:underline text-sm">Accept</button>
                    </form>
                    <form method="POST" action="{% url 'decline_donation' donation.id %}" class="inline">
                      {% csrf_token %}
                      <button type="submit" class="text-red-600 hover:underline text-sm">Decline</button>
                    </form>
                  {% elif donation.status == 'accepted' %}
                    <form method="POST" action="{% url 'mark_delivered' donation.id %}" class="inline">
                      {% csrf_token %}
                      <button type="submit" class="text-green-600 hover:underline text-sm">Mark Delivered</button>
                    </form>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="8" class="py-8 text-center text-gray-500">No donations found</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- TAB 3: Recipient Requests Management -->
    <div data-tab-panel="requests" class="animate-fade-in hidden">
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">üéØ Recipient Requests</h1>
            <p class="text-gray-600">Manage and fulfill requests from recipients.</p>
        </div>
        <div class="bg-white rounded-xl shadow-md p-2 overflow-x-auto">
            <table class="min-w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="py-3 px-4 text-left text-gray-600 font-semibold">Request</th>
                  <th class="py-3 px-4 text-left text-gray-600 font-semibold">Recipient</th>
                  <th class="py-3 px-4 text-left text-gray-600 font-semibold">Category</th>
                  <th class="py-3 px-4 text-left text-gray-600 font-semibold">Urgency</th>
                  <th class="py-3 px-4 text-left text-gray-600 font-semibold">City</th>
                  <th class="py-3 px-4 text-left text-gray-600 font-semibold">Status</th>
                  <th class="py-3 px-4 text-left text-gray-600 font-semibold">Date</th>
                  <th class="py-3 px-4 text-left text-gray-600 font-semibold">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% if requests %}
                  {% for request in requests %}
                  <tr class="border-b hover:bg-gray-50">
                    <td class="py-3 px-4">{{ request.title }}</td>
                    <td class="py-3 px-4">{{ request.recipient.name }}</td>
                    <td class="py-3 px-4">{{ request.category|title }}</td>
                    <td class="py-3 px-4">
                      {% if request.urgency == 'high' %}
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">High</span>
                      {% elif request.urgency == 'medium' %}
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Medium</span>
                      {% else %}
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Low</span>
                      {% endif %}
                    </td>
                    <td class="py-3 px-4">{{ request.recipient.city|default:"N/A" }}</td>
                    <td class="py-3 px-4">
                      {% if request.status == 'fulfilled' %}
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Fulfilled</span>
                      {% elif request.status == 'accepted' %}
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Accepted</span>
                      {% elif request.status == 'cancelled' %}
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Declined</span>
                      {% else %}
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Pending</span>
                      {% endif %}
                    </td>
                    <td class="py-3 px-4">{{ request.created_at|date:"M d, Y" }}</td>
                    <td class="py-3 px-4">
                      {% if request.status == 'pending' %}
                        <form method="POST" action="{% url 'accept_request' request.id %}" class="inline">
                          {% csrf_token %}
                          <button type="submit" class="bg-purple-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-purple-700">Accept</button>
                        </form>
                        <form method="POST" action="{% url 'decline_request' request.id %}" class="inline">
                          {% csrf_token %}
                        <button type="submit" class="bg-red-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-red-700">Decline</button>
                        </form>
                      {% elif request.status == 'accepted' %}
                        <form method="POST" action="{% url 'mark_fulfilled' request.id %}" class="inline">
                          {% csrf_token %}
                          <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-green-700">Mark Fulfilled</button>
                        </form>
                      {% else %}
                        <button class="text-blue-600 hover:underline text-sm">View Details</button>
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="8" class="py-8 text-center text-gray-500">No requests found</td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
        </div>
    </div>
    

    
    <!-- TAB 5: Analytics & Insights -->
    <div data-tab-panel="analytics" class="animate-fade-in hidden">
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">üìà Analytics & Insights</h1>
            <p class="text-gray-600">Visualize your impact and identify trends.</p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Donations vs Requests Trend -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="font-bold text-gray-900 mb-4">Donations vs Requests (Last 6 Months)</h3>
                {% if monthly_donations or monthly_requests %}
                <div class="h-64 flex items-end justify-between space-x-2">
                  {% for item in monthly_donations %}
                  <div class="flex-1 flex flex-col items-center">
                    <div class="w-full bg-purple-500 rounded-t" style="height: {% widthratio item.count 50 100 %}%"></div>
                    <span class="text-xs text-gray-600 mt-2">{{ item.month|date:"M" }}</span>
                  </div>
                  {% endfor %}
                </div>
                {% else %}
                <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
                  <p class="text-gray-500">No trend data available yet</p>
                </div>
                {% endif %}
            </div>

            <!-- Donations by Category -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="font-bold text-gray-900 mb-4">Donations by Category</h3>
                {% if donations_by_category %}
                <div class="h-64 flex items-end justify-around">
                  {% for item in donations_by_category %}
                  <div class="flex flex-col items-center">
                    <div class="w-16 bg-gradient-to-t from-purple-500 to-cyan-500 rounded-t" 
                         style="height: {% widthratio item.count stats.total_donations 200 %}px"></div>
                    <span class="text-xs text-gray-600 mt-2">{{ item.category|truncatewords:1 }}</span>
                    <span class="text-xs font-bold">{{ item.count }}</span>
                  </div>
                  {% endfor %}
                </div>
                {% else %}
                <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
                  <p class="text-gray-500">No category data available yet</p>
                </div>
                {% endif %}
            </div>

            <!-- Top 5 Donor Cities -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="font-bold text-gray-900 mb-4">Top 5 Donor Cities</h3>
                {% if top_cities %}
                <ul class="space-y-3">
                    {% for city in top_cities %}
                    <li class="flex justify-between items-center">
                      <span class="text-gray-700">{{ city.city }}</span>
                      <span class="font-semibold text-gray-900">{{ city.count }} Donations</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <div class="h-48 flex items-center justify-center text-gray-500">
                  No city data available yet
                </div>
                {% endif %}
            </div>

            <!-- Request Urgency Distribution -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="font-bold text-gray-900 mb-4">Request Urgency Distribution</h3>
                {% if urgency_distribution %}
                <div class="space-y-3">
                  {% for item in urgency_distribution %}
                  <div class="flex items-center justify-between">
                    <span class="text-gray-700 capitalize">{{ item.urgency }} Urgency</span>
                    <div class="flex items-center space-x-2">
                      <div class="w-32 bg-gray-200 rounded-full h-3">
                        <div class="h-full rounded-full
                                    {% if item.urgency == 'high' %}bg-red-500
                                    {% elif item.urgency == 'medium' %}bg-yellow-500
                                    {% else %}bg-blue-500{% endif %}"
                             style="width: {% widthratio item.count stats.pending_requests 100 %}%"></div>
                      </div>
                      <span class="font-bold text-gray-900">{{ item.count }}</span>
                    </div>
                  </div>
                  {% endfor %}
                </div>
                {% else %}
                <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
                  <p class="text-gray-500">No urgency data available yet</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- TAB 6: NGO Profile -->
    <div data-tab-panel="profile" class="animate-fade-in hidden">
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">üë§ NGO Profile</h1>
            <p class="text-gray-600">Keep your organization's details up to date.</p>
        </div>
        <div class="bg-white rounded-xl shadow-md p-8 max-w-2xl mx-auto">
            <form class="space-y-6" method="POST">
                {% csrf_token %}
                <div>
                    <label class="block text-sm font-medium text-gray-700">NGO Name</label>
                    <input type="text" value="{{ ngo.ngo_name }}" name="ngo_name" 
                           class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Contact Email</label>
                    <input type="email" value="{{ ngo.user.email }}" name="email"
                           class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Phone Number</label>
                    <input type="text" value="{{ ngo.phone }}" name="phone"
                           class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Website</label>
                    <input type="url" value="{{ ngo.website }}" name="website"
                           class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-2">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">City</label>
                        <input type="text" value="{{ ngo.city }}" name="city"
                               class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">State</label>
                        <input type="text" value="{{ ngo.state }}" name="state"
                               class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-2">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Address</label>
                    <textarea rows="3" name="address" 
                              class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-2">{{ ngo.address }}</textarea>
                </div>
                <div class="text-right">
                    <button type="submit" class="bg-gradient-to-r from-purple-600 to-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:opacity-90 transition-opacity">Update Profile</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- TAB 7: DBMS Demonstration -->
    <div data-tab-panel="dbms" class="animate-fade-in hidden">
        <!-- Hidden CSRF token for AJAX requests -->
        {% csrf_token %}
        
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">üóÑÔ∏è Database Concepts Demonstration</h1>
            <p class="text-gray-600">An interactive look at the SQL queries powering GiveHope.</p>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-4">üîó SQL Joins Demonstration</h3>
            <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                <p class="text-sm text-gray-700">
                    <strong>Database Structure:</strong> The GiveHope system uses several interconnected tables:
                    <span class="font-medium">donors</span> (people who donate items),
                    <span class="font-medium">donations</span> (items being donated),
                    <span class="font-medium">recipients</span> (people in need),
                    <span class="font-medium">requests</span> (items needed),
                    and <span class="font-medium">ngos</span> (organizations that facilitate donations).
                </p>
            </div>
            <div class="flex flex-wrap gap-2 mb-4 border-b pb-4">
                <button onclick="showJoinQuery('inner')" class="px-4 py-2 rounded-lg bg-purple-600 text-white text-sm">Donation-Donor JOIN</button>
                <button onclick="showJoinQuery('left')" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-sm">Request-Recipient JOIN</button>
                <button onclick="showJoinQuery('right')" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-sm">Donor-Donation JOIN</button>
                <button onclick="showJoinQuery('self')" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-sm">Recipient SELF JOIN</button>
                <button onclick="showJoinQuery('complex')" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-sm">Donation-Donor-NGO JOIN</button>
                <button onclick="showJoinQuery('full')" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-sm">Complete Donation JOIN</button>
                <button onclick="showJoinQuery('request_full')" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-sm">Complete Request JOIN</button>
            </div>
            
            <div id="query-display" class="bg-gray-50 rounded-lg p-4">
                <p id="query-description" class="text-gray-700 mb-4">Select a JOIN type to see the SQL query and real data from the database.</p>
                <div id="sql-query-box" class="bg-gray-800 text-white rounded-lg p-4 font-mono text-sm hidden">
                    <p class="text-gray-300 mb-2">// SQL Query:</p>
                    <pre id="query-content"></pre>
                </div>
                <div id="join-results-table" class="overflow-x-auto mt-4 hidden">
                    <p class="text-sm text-gray-600 mb-2">// Real Database Results:</p>
                    <table class="min-w-full bg-white rounded-lg border">
                        <thead id="results-head" class="bg-gray-100"></thead>
                        <tbody id="results-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

  </main>
</div>

<script>
  // --- Tab Activation Logic ---
  function activateTab(tabId) {
    document.querySelectorAll('[data-tab-panel]').forEach(panel => {
      panel.classList.add('hidden');
      panel.classList.remove('animate-fade-in');
    });
    
    document.querySelectorAll('[data-tab-btn]').forEach(btn => {
      btn.classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-cyan-500', 'text-white', 'shadow-lg');
      btn.classList.add('text-gray-700', 'hover:bg-gray-100');
    });
    
    const activePanel = document.querySelector(`[data-tab-panel="${tabId}"]`);
    if (activePanel) {
      activePanel.classList.remove('hidden');
      setTimeout(() => activePanel.classList.add('animate-fade-in'), 10);
      
      // If activating the DBMS tab, show the first join example
      if (tabId === 'dbms') {
        // Small delay to ensure the tab is fully rendered
        setTimeout(() => showJoinQuery('inner'), 100);
      }
    }
    
    const activeButton = document.querySelector(`[data-tab-btn="${tabId}"]`);
    if (activeButton) {
      activeButton.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-cyan-500', 'text-white', 'shadow-lg');
      activeButton.classList.remove('text-gray-700', 'hover:bg-gray-100');
    }
  }

  // --- DBMS Demo Logic ---
  const joinData = {
    inner: {
      description: 'INNER JOIN: Shows donations with their donor information. Only donations that have matching donors are included.',
      apiEndpoint: '/api/dbms/inner/',
      query: '',
      headers: [],
      results: []
    },
    left: {
      description: 'LEFT JOIN: Shows all requests and includes recipient information when available. If a request has no recipient, recipient fields will be NULL.',
      apiEndpoint: '/api/dbms/left/',
      query: '',
      headers: [],
      results: []
    },
    right: {
      description: 'RIGHT JOIN: Shows all donors and includes donation information when available. If a donor has no donations, donation fields will be NULL.',
      apiEndpoint: '/api/dbms/right/',
      query: '',
      headers: [],
      results: []
    },
    self: {
      description: 'SELF JOIN: Shows recipients who are from the same city.',
      apiEndpoint: '/api/dbms/self/',
      query: '',
      headers: [],
      results: []
    },
    complex: {
      description: 'COMPLEX JOIN: Shows donations that have been accepted by an NGO, along with donor and NGO information.',
      apiEndpoint: '/api/dbms/complex/',
      query: '',
      headers: [],
      results: []
    },
    full: {
      description: 'MULTIPLE JOIN: Shows the complete relationship between donations, donors, and NGOs with additional details.',
      apiEndpoint: '/api/dbms/full/',
      query: '',
      headers: [],
      results: []
    },
    request_full: {
      description: 'COMPLETE REQUEST JOIN: Shows all requests with recipient details and urgency information.',
      apiEndpoint: '/api/dbms/request_full/',
      query: '',
      headers: [],
      results: []
    }
  };

  function showJoinQuery(joinType) {
    const data = joinData[joinType];
    if (!data) return;

    // Update description
    document.getElementById('query-description').textContent = data.description;
    
    // Show loading state
    document.getElementById('sql-query-box').classList.remove('hidden');
    document.getElementById('join-results-table').classList.remove('hidden');
    document.getElementById('query-content').textContent = 'Loading...';
    
    // Clear previous results
    const head = document.getElementById('results-head');
    const body = document.getElementById('results-body');
    head.innerHTML = '';
    body.innerHTML = '';
    
    // Fetch real data from API
    fetch(data.apiEndpoint)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(result => {
        // Update query and results
        document.getElementById('query-content').textContent = result.query;
        data.headers = result.headers;
        data.results = result.results;
        
        // Update table headers
        head.innerHTML = '';
        const headerRow = document.createElement('tr');
        data.headers.forEach(headerText => {
            const th = document.createElement('th');
            th.className = 'py-2 px-3 text-left text-sm font-semibold text-gray-600';
            th.textContent = headerText;
            headerRow.appendChild(th);
        });
        head.appendChild(headerRow);

        // Update table rows
        body.innerHTML = '';
        data.results.forEach(rowData => {
            const tr = document.createElement('tr');
            tr.className = 'border-t';
            rowData.forEach(cellData => {
                const td = document.createElement('td');
                td.className = 'py-2 px-3 text-sm';
                td.textContent = cellData;
                if (cellData === 'NULL') {
                    td.classList.add('text-gray-400', 'italic');
                }
                tr.appendChild(td);
            });
            body.appendChild(tr);
        });
      })
      .catch(error => {
        console.error('Error fetching join data:', error);
        document.getElementById('query-content').textContent = 'Error loading data. Please try again.';
        // Show error in table
        head.innerHTML = '';
        body.innerHTML = '<tr><td colspan="10" class="text-center py-4 text-red-500">Failed to load data: ' + error.message + '</td></tr>';
      });
  }

  // --- Page Initialization ---
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('[data-tab-btn]').forEach(btn => {
      btn.addEventListener('click', () => {
        const tabId = btn.getAttribute('data-tab-btn');
        activateTab(tabId);
      });
    });

    activateTab('dashboard');
  });
</script>
{% endblock %}