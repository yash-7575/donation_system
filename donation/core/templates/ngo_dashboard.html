{% extends 'base.html' %}
{% block title %}NGO Dashboard ‚Äî GiveHope{% endblock %}
{% block content %}
<div id="ngo-scope" class="min-h-screen bg-gradient-to-br from-purple-50 via-cyan-50 to-orange-50 flex">
  <!-- Left Fixed Sidebar -->
  <aside class="w-64 bg-white shadow-lg fixed h-full flex flex-col">
    <div class="p-6 border-b">
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-12 h-12 bg-gradient-to-br from-purple-600 to-cyan-500 rounded-xl flex items-center justify-center">
          <span class="text-white text-2xl font-bold">‚ù§</span>
        </div>
        <span class="text-xl font-bold bg-gradient-to-r from-purple-600 to-cyan-600 bg-clip-text text-transparent">GiveHope</span>
      </div>
      <div class="flex items-center space-x-3 mt-6">
        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-orange-400 rounded-full flex items-center justify-center text-white font-bold">
          {{ ngo.ngo_name|first|upper }}
        </div>
        <div class="flex-1 min-w-0">
          <div class="font-semibold text-gray-900 truncate">{{ ngo.ngo_name }}</div>
          <div class="text-xs text-gray-500 truncate">{{ ngo.city }}, {{ ngo.state }}</div>
        </div>
      </div>
    </div>
    <nav class="p-4 space-y-2 flex-1 overflow-y-auto">
      <button data-tab-btn="dashboard" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üìä Dashboard</span></button>
      <button data-tab-btn="donations" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üéÅ Donations</span></button>
      <button data-tab-btn="requests" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üéØ Requests</span></button>
      <button data-tab-btn="analytics" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üìà Analytics</span></button>
      <a href="{% url 'ngo_feedback' %}" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100"><span>üí¨ Feedback</span></a>
      <button data-tab-btn="profile" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üë§ Profile</span></button>
      <button data-tab-btn="dbms" class="w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all"><span>üóÑÔ∏è DBMS Demo</span></button>
    </nav>
    <div class="p-4 border-t">
        <a href="{% url 'logout' %}" class="block text-center text-red-600 px-4 py-3 rounded-lg hover:bg-red-50 transition-all">üö™ Logout</a>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="flex-1 ml-64 p-8">
    <!-- TAB 1: Dashboard Overview -->
    <div data-tab-panel="dashboard" class="animate-fade-in">
      <div class="bg-gradient-to-r from-purple-600 to-cyan-500 text-white rounded-xl shadow-lg p-6 mb-8">
        <h1 class="text-3xl font-bold mb-2">Welcome back, {{ ngo.ngo_name }}!</h1>
        <p class="opacity-80">Here's your real-time impact overview. Keep up the great work!</p>
      </div>
      
      <!-- Stats Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-purple-100 text-purple-600 text-2xl">üéÅ</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.total_donations }}</div>
            <div class="text-gray-600">Total Donations</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-yellow-100 text-yellow-600 text-2xl">‚è≥</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.pending_requests }}</div>
            <div class="text-gray-600">Pending Requests</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-blue-100 text-blue-600 text-2xl">‚úÖ</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.accepted_donations }}</div>
            <div class="text-gray-600">Accepted Donations</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-green-100 text-green-600 text-2xl">üì¶</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.delivered_donations }}</div>
            <div class="text-gray-600">Delivered Donations</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-purple-100 text-purple-600 text-2xl">‚úîÔ∏è</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.fulfilled_requests }}</div>
            <div class="text-gray-600">Fulfilled Requests</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-orange-100 text-orange-600 text-2xl">‚≠ê</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.avg_rating }}/5</div>
            <div class="text-gray-600">Average Rating</div>
          </div>
        </div>
        <div class="bg-white rounded-xl shadow-md p-6 flex items-center space-x-4">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-blue-100 text-blue-600 text-2xl">üë•</div>
          <div>
            <div class="text-3xl font-bold text-gray-900">{{ stats.active_donors }}</div>
            <div class="text-gray-600">Active Donors</div>
          </div>
        </div>
      </div>
      
      <!-- Chart: Donations by Category -->
      <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">Donations by Category</h3>
        {% if donations_by_category %}
        <div class="space-y-3">
          {% for item in donations_by_category %}
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3 flex-1">
              <div class="w-32 text-gray-700 font-medium">{{ item.category|title }}</div>
              <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">
                <div class="bg-gradient-to-r from-purple-500 to-cyan-500 h-full rounded-full" 
                     style="width: {% widthratio item.count stats.total_donations 100 %}%"></div>
              </div>
            </div>
            <div class="text-gray-900 font-bold ml-4">{{ item.count }}</div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
          <p class="text-gray-500">No donation data available yet</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- TAB 2: Donations Management -->
    <div data-tab-panel="donations" class="animate-fade-in hidden">
      <div class="bg-white rounded-xl shadow-md p-6 mb-8">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">üéÅ Donations Management</h1>
                <p class="text-gray-600">Track and manage all incoming donations.</p>
            </div>
            <div class="flex items-center space-x-2">
                <form method="GET" action="{% url 'ngo' %}" class="flex items-center space-x-2">
                    <select name="category" class="border border-gray-300 rounded-lg p-2" onchange="this.form.submit()">
                        <option value="">All Categories</option>
                        {% for category in available_categories %}
                        <option value="{{ category }}" {% if selected_category == category %}selected{% endif %}>
                            {{ category|title }}
                        </option>
                        {% endfor %}
                    </select>
                    <input type="text" name="search" value="{{ search_query }}" placeholder="Search donations..." 
                           class="border border-gray-300 rounded-lg p-2 w-64">
                    <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">Search</button>
                </form>
            </div>
        </div>
      </div>
      <div class="bg-white rounded-xl shadow-md p-2 overflow-x-auto">
        <table class="min-w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Title</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Category</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Qty</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Status</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Donor Name</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">City</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Date</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if donations %}
              {% for donation in donations %}
              <tr class="border-b hover:bg-gray-50">
                <td class="py-3 px-4">{{ donation.title }}</td>
                <td class="py-3 px-4">{{ donation.category|title }}</td>
                <td class="py-3 px-4">{{ donation.quantity }}</td>
                <td class="py-3 px-4">
                  {% if donation.status == 'delivered' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Delivered</span>
                  {% elif donation.status == 'accepted' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Accepted</span>
                  {% elif donation.status == 'cancelled' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Declined</span>
                  {% else %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Pending</span>
                  {% endif %}
                </td>
                <td class="py-3 px-4">{{ donation.donor.name }}</td>
                <td class="py-3 px-4">{{ donation.donor.city|default:"N/A" }}</td>
                <td class="py-3 px-4">{{ donation.created_at|date:"M d, Y" }}</td>
                <td class="py-3 px-4 space-x-2">
                  <button class="text-blue-600 hover:underline text-sm">View</button>
                  {% if donation.status == 'pending' %}
                    <form method="POST" action="{% url 'accept_donation' donation.id %}" class="inline">
                      {% csrf_token %}
                      <button type="submit" class="text-purple-600 hover:underline text-sm">Accept</button>
                    </form>
                    <form method="POST" action="{% url 'decline_donation' donation.id %}" class="inline">
                      {% csrf_token %}
                      <button type="submit" class="text-red-600 hover:underline text-sm">Decline</button>
                    </form>
                  {% elif donation.status == 'accepted' %}
                    <form method="POST" action="{% url 'mark_delivered' donation.id %}" class="inline">
                      {% csrf_token %}
                      <button type="submit" class="text-green-600 hover:underline text-sm">Mark Delivered</button>
                    </form>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="8" class="py-6 px-4 text-center text-gray-500">No donations found</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- TAB 3: Requests Management -->
    <div data-tab-panel="requests" class="animate-fade-in hidden">
      <div class="bg-white rounded-xl shadow-md p-6 mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">üéØ Requests Management</h1>
        <p class="text-gray-600">Track and manage all incoming requests from recipients.</p>
      </div>
      <div class="bg-white rounded-xl shadow-md p-2 overflow-x-auto">
        <table class="min-w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Title</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Category</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Urgency</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Status</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Recipient Name</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">City</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Family Size</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Date</th>
              <th class="py-3 px-4 text-left text-gray-600 font-semibold">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if requests %}
              {% for request in requests %}
              <tr class="border-b hover:bg-gray-50">
                <td class="py-3 px-4">{{ request.title }}</td>
                <td class="py-3 px-4">{{ request.category|title }}</td>
                <td class="py-3 px-4">
                  {% if request.urgency == 'critical' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Critical</span>
                  {% elif request.urgency == 'high' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800">High</span>
                  {% elif request.urgency == 'medium' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Medium</span>
                  {% else %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Low</span>
                  {% endif %}
                </td>
                <td class="py-3 px-4">
                  {% if request.status == 'fulfilled' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Fulfilled</span>
                  {% elif request.status == 'accepted' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Accepted</span>
                  {% elif request.status == 'cancelled' %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Declined</span>
                  {% else %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Pending</span>
                  {% endif %}
                </td>
                <td class="py-3 px-4">{{ request.recipient.name }}</td>
                <td class="py-3 px-4">{{ request.recipient.city|default:"N/A" }}</td>
                <td class="py-3 px-4">{{ request.recipient.family_size }}</td>
                <td class="py-3 px-4">{{ request.created_at|date:"M d, Y" }}</td>
                <td class="py-3 px-4 space-x-2">
                  <button class="text-blue-600 hover:underline text-sm">View</button>
                  {% if request.status == 'pending' %}
                    <form method="POST" action="{% url 'accept_request' request.id %}" class="inline">
                      {% csrf_token %}
                      <button type="submit" class="text-purple-600 hover:underline text-sm">Accept</button>
                    </form>
                    <form method="POST" action="{% url 'decline_request' request.id %}" class="inline">
                      {% csrf_token %}
                      <button type="submit" class="text-red-600 hover:underline text-sm">Decline</button>
                    </form>
                  {% elif request.status == 'accepted' %}
                    <form method="POST" action="{% url 'mark_fulfilled' request.id %}" class="inline">
                      {% csrf_token %}
                      <button type="submit" class="text-green-600 hover:underline text-sm">Mark Fulfilled</button>
                    </form>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="9" class="py-6 px-4 text-center text-gray-500">No requests found</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- TAB 4: Analytics -->
    <div data-tab-panel="analytics" class="animate-fade-in hidden">
      <div class="bg-white rounded-xl shadow-md p-6 mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">üìà Analytics Dashboard</h1>
        <p class="text-gray-600">Detailed insights and trends for your NGO operations.</p>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Top Cities Chart -->
        <div class="bg-white rounded-xl shadow-md p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">Top Donor Cities</h3>
          {% if top_cities %}
            <div class="space-y-3">
              {% for city in top_cities %}
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-3 flex-1">
                    <div class="w-32 text-gray-700 font-medium">{{ city.city }}</div>
                    <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">
                      <div class="bg-gradient-to-r from-purple-500 to-cyan-500 h-full rounded-full" 
                           style="width: {% widthratio city.count top_cities.0.count 100 %}%"></div>
                    </div>
                  </div>
                  <div class="text-gray-900 font-bold ml-4">{{ city.count }}</div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="h-48 bg-gray-50 rounded-lg flex items-center justify-center">
              <p class="text-gray-500">No city data available yet</p>
            </div>
          {% endif %}
        </div>
        
        <!-- Request Urgency Distribution -->
        <div class="bg-white rounded-xl shadow-md p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">Request Urgency Distribution</h3>
          {% if urgency_distribution %}
            <div class="space-y-3">
              {% for item in urgency_distribution %}
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-3 flex-1">
                    <div class="w-32 text-gray-700 font-medium">{{ item.urgency|title }}</div>
                    <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">
                      <div class="bg-gradient-to-r from-purple-500 to-cyan-500 h-full rounded-full" 
                           style="width: {% widthratio item.count urgency_distribution.0.count 100 %}%"></div>
                    </div>
                  </div>
                  <div class="text-gray-900 font-bold ml-4">{{ item.count }}</div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="h-48 bg-gray-50 rounded-lg flex items-center justify-center">
              <p class="text-gray-500">No urgency data available yet</p>
            </div>
          {% endif %}
        </div>
      </div>
      
      <!-- Monthly Trends -->
      <div class="bg-white rounded-xl shadow-md p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">Monthly Activity Trends</h3>
        {% if monthly_donations or monthly_requests %}
          <div class="h-64 flex items-end space-x-2 justify-center">
            {% for i in "012345" %}
              {% with month_index=i|add:"0" %}
                {% for donation in monthly_donations %}
                  {% if donation.month.month == month_index %}
                    <div class="flex flex-col items-center">
                      <div class="w-12 bg-purple-500 rounded-t" style="height: {% widthratio donation.count 1 10 %}px"></div>
                      <div class="text-xs text-gray-600 mt-2">{{ donation.month|date:"M" }}</div>
                      <div class="text-xs text-purple-600">D: {{ donation.count }}</div>
                    </div>
                  {% endif %}
                {% endfor %}
                {% for request in monthly_requests %}
                  {% if request.month.month == month_index %}
                    <div class="flex flex-col items-center">
                      <div class="w-12 bg-cyan-500 rounded-t" style="height: {% widthratio request.count 1 10 %}px"></div>
                      <div class="text-xs text-gray-600 mt-2">{{ request.month|date:"M" }}</div>
                      <div class="text-xs text-cyan-600">R: {{ request.count }}</div>
                    </div>
                  {% endif %}
                {% endfor %}
              {% endwith %}
            {% endfor %}
          </div>
        {% else %}
          <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
            <p class="text-gray-500">No trend data available yet</p>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- TAB 5: Profile -->
    <div data-tab-panel="profile" class="animate-fade-in hidden">
      <div class="bg-white rounded-xl shadow-md p-6 mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">üë§ NGO Profile</h1>
        <p class="text-gray-600">Manage your organization's information and settings.</p>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Profile Card -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex flex-col items-center">
              <div class="w-24 h-24 bg-gradient-to-br from-purple-500 to-orange-400 rounded-full flex items-center justify-center text-white text-3xl font-bold mb-4">
                {{ ngo.ngo_name|first|upper }}
              </div>
              <h2 class="text-xl font-bold text-gray-900">{{ ngo.ngo_name }}</h2>
              <p class="text-gray-600">{{ ngo.city }}, {{ ngo.state }}</p>
              <div class="mt-4 w-full">
                <div class="flex justify-between text-sm text-gray-600">
                  <span>Member since</span>
                  <span>{{ ngo.user.date_joined|date:"M Y" }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Profile Form -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-xl shadow-md p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4">Organization Information</h3>
            <form class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">NGO Name</label>
                  <input type="text" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg" value="{{ ngo.ngo_name }}">
                </div>
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">Phone</label>
                  <input type="tel" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg" value="{{ ngo.phone }}">
                </div>
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">Website</label>
                  <input type="url" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg" value="{{ ngo.website|default:'' }}">
                </div>
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">City</label>
                  <input type="text" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg" value="{{ ngo.city }}">
                </div>
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Address</label>
                <textarea class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg" rows="3">{{ ngo.address|default:'' }}</textarea>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">State</label>
                  <input type="text" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg" value="{{ ngo.state }}">
                </div>
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2">Pincode</label>
                  <input type="text" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg" value="{{ ngo.pincode }}">
                </div>
              </div>
              <div class="flex justify-end gap-3 pt-4">
                <button type="button" class="px-6 py-3 rounded-lg border-2 border-gray-300 text-gray-700">Cancel</button>
                <button type="submit" class="px-6 py-3 rounded-lg bg-gradient-to-r from-purple-600 to-cyan-500 text-white">Update Profile</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB 6: DBMS Demo -->
    <div data-tab-panel="dbms" class="animate-fade-in hidden">
      <div class="bg-white rounded-xl shadow-md p-6 mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">üóÑÔ∏è Database Management System Demo</h1>
        <p class="text-gray-600">Explore various SQL JOIN operations and database queries.</p>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- INNER JOIN Demo -->
        <div class="bg-white rounded-xl shadow-md p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">INNER JOIN - Donations with Donors</h3>
          <div class="mb-4">
            <pre class="bg-gray-100 p-4 rounded-lg text-sm overflow-x-auto">SELECT D.title, D.category, DO.name AS donor_name, D.status
FROM donations AS D
INNER JOIN donors AS DO ON D.donor_id = DO.id;</pre>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Donation Title</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Category</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Donor Name</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Status</th>
                </tr>
              </thead>
              <tbody id="inner-join-results">
                <tr>
                  <td colspan="4" class="py-4 px-3 text-center text-gray-500">Loading data...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- LEFT JOIN Demo -->
        <div class="bg-white rounded-xl shadow-md p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">LEFT JOIN - Requests with Recipients</h3>
          <div class="mb-4">
            <pre class="bg-gray-100 p-4 rounded-lg text-sm overflow-x-auto">SELECT R.title, RE.name AS recipient_name, R.status, RE.city
FROM requests AS R
LEFT JOIN recipients AS RE ON R.recipient_id = RE.id;</pre>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Request Title</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Recipient Name</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Status</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">City</th>
                </tr>
              </thead>
              <tbody id="left-join-results">
                <tr>
                  <td colspan="4" class="py-4 px-3 text-center text-gray-500">Loading data...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- RIGHT JOIN Demo -->
        <div class="bg-white rounded-xl shadow-md p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">RIGHT JOIN - Donors with Donations</h3>
          <div class="mb-4">
            <pre class="bg-gray-100 p-4 rounded-lg text-sm overflow-x-auto">SELECT DO.name AS donor_name, DO.city, D.title AS donation_title, D.status
FROM donors AS DO
RIGHT JOIN donations AS D ON DO.id = D.donor_id;</pre>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Donor Name</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">City</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Donation Title</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Status</th>
                </tr>
              </thead>
              <tbody id="right-join-results">
                <tr>
                  <td colspan="4" class="py-4 px-3 text-center text-gray-500">Loading data...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- SELF JOIN Demo -->
        <div class="bg-white rounded-xl shadow-md p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">SELF JOIN - Recipients in Same City</h3>
          <div class="mb-4">
            <pre class="bg-gray-100 p-4 rounded-lg text-sm overflow-x-auto">SELECT A.name, B.name, A.city
FROM recipients A, recipients B
WHERE A.id <> B.id AND A.city = B.city;</pre>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Recipient Name</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Other Recipient</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">City</th>
                </tr>
              </thead>
              <tbody id="self-join-results">
                <tr>
                  <td colspan="3" class="py-4 px-3 text-center text-gray-500">Loading data...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- COMPLEX JOIN Demo -->
        <div class="bg-white rounded-xl shadow-md p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">COMPLEX JOIN - Accepted Donations</h3>
          <div class="mb-4">
            <pre class="bg-gray-100 p-4 rounded-lg text-sm overflow-x-auto">SELECT D.title, DO.name AS donor_name, N.ngo_name, D.category, D.status
FROM donations AS D
INNER JOIN donors AS DO ON D.donor_id = DO.id
INNER JOIN ngos AS N ON D.ngo_id = N.id
WHERE D.status = 'accepted';</pre>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Donation Title</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Donor Name</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">NGO Name</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Category</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Status</th>
                </tr>
              </thead>
              <tbody id="complex-join-results">
                <tr>
                  <td colspan="5" class="py-4 px-3 text-center text-gray-500">Loading data...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- FULL JOIN Demo -->
        <div class="bg-white rounded-xl shadow-md p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">FULL JOIN - All Donations</h3>
          <div class="mb-4">
            <pre class="bg-gray-100 p-4 rounded-lg text-sm overflow-x-auto">SELECT D.title AS donation_title, DO.name AS donor_name, N.ngo_name, D.status, D.category
FROM donations AS D
LEFT JOIN donors AS DO ON D.donor_id = DO.id
LEFT JOIN ngos AS N ON D.ngo_id = N.id
ORDER BY D.created_at DESC;</pre>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Donation Title</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Donor Name</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">NGO Name</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Status</th>
                  <th class="py-2 px-3 text-left text-gray-600 font-semibold">Category</th>
                </tr>
              </thead>
              <tbody id="full-join-results">
                <tr>
                  <td colspan="5" class="py-4 px-3 text-center text-gray-500">Loading data...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
// Tab switching functionality
document.querySelectorAll('[data-tab-btn]').forEach(button => {
  button.addEventListener('click', () => {
    const tabName = button.getAttribute('data-tab-btn');
    
    // Hide all tab panels
    document.querySelectorAll('[data-tab-panel]').forEach(panel => {
      panel.classList.add('hidden');
    });
    
    // Show the selected tab panel
    document.querySelector(`[data-tab-panel="${tabName}"]`).classList.remove('hidden');
    
    // Update active button state
    document.querySelectorAll('[data-tab-btn]').forEach(btn => {
      btn.classList.remove('bg-purple-100', 'text-purple-700', 'font-semibold');
      btn.classList.add('text-gray-700');
    });
    
    button.classList.add('bg-purple-100', 'text-purple-700', 'font-semibold');
  });
});

// Load DBMS demo data
document.addEventListener('DOMContentLoaded', function() {
  // INNER JOIN
  fetch('/api/dbms/inner/')
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById('inner-join-results');
      tbody.innerHTML = '';
      data.results.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-3">${row[0]}</td>
          <td class="py-2 px-3">${row[1]}</td>
          <td class="py-2 px-3">${row[2]}</td>
          <td class="py-2 px-3">${row[3]}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(error => {
      console.error('Error loading inner join data:', error);
    });

  // LEFT JOIN
  fetch('/api/dbms/left/')
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById('left-join-results');
      tbody.innerHTML = '';
      data.results.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-3">${row[0]}</td>
          <td class="py-2 px-3">${row[1]}</td>
          <td class="py-2 px-3">${row[2]}</td>
          <td class="py-2 px-3">${row[3]}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(error => {
      console.error('Error loading left join data:', error);
    });

  // RIGHT JOIN
  fetch('/api/dbms/right/')
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById('right-join-results');
      tbody.innerHTML = '';
      data.results.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-3">${row[0]}</td>
          <td class="py-2 px-3">${row[1]}</td>
          <td class="py-2 px-3">${row[2]}</td>
          <td class="py-2 px-3">${row[3]}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(error => {
      console.error('Error loading right join data:', error);
    });

  // SELF JOIN
  fetch('/api/dbms/self/')
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById('self-join-results');
      tbody.innerHTML = '';
      data.results.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-3">${row[0]}</td>
          <td class="py-2 px-3">${row[1]}</td>
          <td class="py-2 px-3">${row[2]}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(error => {
      console.error('Error loading self join data:', error);
    });

  // COMPLEX JOIN
  fetch('/api/dbms/complex/')
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById('complex-join-results');
      tbody.innerHTML = '';
      data.results.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-3">${row[0]}</td>
          <td class="py-2 px-3">${row[1]}</td>
          <td class="py-2 px-3">${row[2]}</td>
          <td class="py-2 px-3">${row[3]}</td>
          <td class="py-2 px-3">${row[4]}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(error => {
      console.error('Error loading complex join data:', error);
    });

  // FULL JOIN
  fetch('/api/dbms/full/')
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById('full-join-results');
      tbody.innerHTML = '';
      data.results.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 px-3">${row[0]}</td>
          <td class="py-2 px-3">${row[1]}</td>
          <td class="py-2 px-3">${row[2]}</td>
          <td class="py-2 px-3">${row[3]}</td>
          <td class="py-2 px-3">${row[4]}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(error => {
      console.error('Error loading full join data:', error);
    });
});
</script>
{% endblock %}